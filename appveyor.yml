#---------------------------------#
#      general configuration      #
#---------------------------------#
# version format
version: 1.0.{build}
os: Visual Studio 2015
configuration: Release
platform: Any CPU

#---------------------------------#
#        environment init         #
#---------------------------------#
init:
- cmd: set PATH=C:\Program Files (x86)\MSBuild\14.0\Bin;%PATH%

install:
- cmd: >-
    nuget install redis-64 -excludeversion

    redis-64\tools\redis-server.exe --service-install

    redis-64\tools\redis-server.exe --service-start

#---------------------------------#
#       build configuration       #
#---------------------------------#

before_build:
- appveyor-retry dotnet restore "src\StackExchange.Redis.Extensions.Core\project.json" -v Minimal
- appveyor-retry dotnet restore "src\Serializers\StackExchange.Redis.Extensions.Newtonsoft\project.json" -v Minimal
- appveyor-retry dotnet restore "src\Serializers\StackExchange.Redis.Extensions.MsgPack\project.json" -v Minimal
- appveyor-retry dotnet restore "src\Serializers\StackExchange.Redis.Extensions.Protobuf\project.json" -v Minimal
- appveyor-retry dotnet restore "tests\StackExchange.Redis.Extensions.Tests\project.json" -v Minimal
build_script:
- dotnet build "src\StackExchange.Redis.Extensions.Core\project.json" -c Release
- dotnet build "src\Serializers\StackExchange.Redis.Extensions.Newtonsoft\project.json" -c Release
- dotnet build "src\Serializers\StackExchange.Redis.Extensions.MsgPack\project.json" -c Release
- dotnet build "src\Serializers\StackExchange.Redis.Extensions.Protobuf\project.json" -c Release
- dotnet build "tests\StackExchange.Redis.Extensions.Tests\project.json" 


# - dotnet build "src\Serializers\StackExchange.Redis.Extensions.Jil\project.json" -c Release -o .\nuget # currently not supported

# after_build:  .\src\Serializers\StackExchange.Redis.Extensions.Protobuf\project.json -c Release -o .\nuget 
# - dotnet pack .\src\StackExchange.Redis.Extensions.Core\project.json -c Release -o .\nuget
# - dotnet pack .\src\Serializers\StackExchange.Redis.Extensions.Jil\project.json -c Release -o .\nuget 
# - dotnet pack .\src\Serializers\StackExchange.Redis.Extensions.Newtonsoft\project.json -c Release -o .\nuget 
# - dotnet pack .\src\Serializers\StackExchange.Redis.Extensions.MsgPack\project.json -c Release -o .\nuget 
# - dotnet pack .\src\Serializers\StackExchange.Redis.Extensions.Protobuf\project.json -c Release -o .\nuget 

test_script:
- dotnet test "tests\StackExchange.Redis.Extensions.Tests" -c Release

# artifacts:
# - path: artifacts\**\*.*
cache:
- '%USERPROFILE%\.nuget\packages'

#---------------------------------#
#       deploy configuration      #
#---------------------------------#
#deploy:
#  provider: NuGet
#  api_key:
#    secure: RiD8ByY1UxUnp+hyurAO3Ux8naiPVRMUX55HjjYe/ItiuKYk1PBGS9NgH80FbQ6C
#  artifact: /.*\.nupkg/
#  on:
#    branch: master
#    appveyor_repo_tag: true
